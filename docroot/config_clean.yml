---
- hosts: localhost
  connection: local
  gather_facts: no

  vars_files:
    - devops/reinstall/vars/global_settings.yml
    - devops/reinstall/vars/environments/global_env.yml
  vars:
    profile: pp
    staging: sites/default/config/staging
    exclude:
      # Core modules configuration files:
      - { name: 'action.settings.yml', status: true }
      - { name: 'automated_cron.settings.yml', status: true }
      - { name: 'block.block.bartik_account_menu.yml', status: true }
      - { name: 'block.block.bartik_branding.yml', status: true }
      - { name: 'block.block.bartik_breadcrumbs.yml', status: true }
      - { name: 'block.block.bartik_content.yml', status: true }
      - { name: 'block.block.bartik_footer.yml', status: true }
      - { name: 'block.block.bartik_help.yml', status: true }
      - { name: 'block.block.bartik_local_actions.yml', status: true }
      - { name: 'block.block.bartik_local_tasks.yml', status: true }
      - { name: 'block.block.bartik_main_menu.yml', status: true }
      - { name: 'block.block.bartik_page_title.yml', status: true }
      - { name: 'block.block.bartik_powered.yml', status: true }
      - { name: 'block.block.bartik_search.yml', status: true }
      - { name: 'block.block.bartik_tools.yml', status: true }
      - { name: 'contact.form.feedback.yml', status: true }
      - { name: 'contact.form.personal.yml', status: true }
      - { name: 'contact.settings.yml', status: true }
      - { name: 'core.date_format.fallback.yml', status: true }
      - { name: 'core.date_format.html_datetime.yml', status: true }
      - { name: 'core.date_format.html_date.yml', status: true }
      - { name: 'core.date_format.html_month.yml', status: true }
      - { name: 'core.date_format.html_time.yml', status: true }
      - { name: 'core.date_format.html_week.yml', status: true }
      - { name: 'core.date_format.html_yearless_date.yml', status: true }
      - { name: 'core.date_format.html_year.yml', status: true }
      - { name: 'core.date_format.long.yml', status: true }
      - { name: 'core.date_format.medium.yml', status: true }
      - { name: 'core.date_format.short.yml', status: true }
      - { name: 'core.extension.yml', status: true }
      - { name: 'core.entity_form_display.comment.comment.default.yml', status: true }
      - { name: 'core.entity_view_display.comment.comment.default.yml', status: true }
      - { name: 'dblog.settings.yml', status: true }
      - { name: 'image.style.thumbnail.yml', status: true }
      - { name: 'rdf.mapping.comment.comment.yml', status: true }
      - { name: 'rdf.mapping.node.article.yml', status: true }
      - { name: 'rdf.mapping.node.page.yml', status: true }
      - { name: 'rdf.mapping.taxonomy_term.tags.yml', status: true }
      - { name: 'rdf.mapping.user.user.yml', status: true }
      - { name: 'search.page.node_search.yml', status: true }
      - { name: 'search.page.user_search.yml', status: true }
      - { name: 'search.settings.yml', status: true }
      - { name: 'system.action.comment_publish_action.yml', status: true }
      - { name: 'system.action.comment_save_action.yml', status: true }
      - { name: 'system.action.comment_unpublish_action.yml', status: true }
      - { name: 'system.action.file_delete_action.yml', status: true }
      - { name: 'system.action.file_permanent_action.yml', status: true }
      - { name: 'system.action.file_temporary_action.yml', status: true }
      - { name: 'system.action.node_delete_action.yml', status: true }
      - { name: 'system.action.node_make_sticky_action.yml', status: true }
      - { name: 'system.action.node_make_unsticky_action.yml', status: true }
      - { name: 'system.action.node_promote_action.yml', status: true }
      - { name: 'system.action.node_publish_action.yml', status: true }
      - { name: 'system.action.node_save_action.yml', status: true }
      - { name: 'system.action.node_unpromote_action.yml', status: true }
      - { name: 'system.action.node_unpublish_action.yml', status: true }
      - { name: 'system.action.user_add_role_action.administrator.yml', status: true }
      - { name: 'system.action.user_block_user_action.yml', status: true }
      - { name: 'system.action.user_cancel_user_action.yml', status: true }
      - { name: 'system.action.user_remove_role_action.administrator.yml', status: true }
      - { name: 'system.action.user_unblock_user_action.yml', status: true }
      - { name: 'system.action.user_add_role_action.editor.yml', status: true }
      - { name: 'system.action.user_add_role_action.location_editor.yml', status: true }
      - { name: 'system.action.user_remove_role_action.editor.yml', status: true }
      - { name: 'system.action.user_remove_role_action.location_editor.yml', status: true }
      - { name: 'update.settings.yml', status: true }
      - { name: 'views.settings.yml', status: true }
      - { name: 'views.view.archive.yml', status: true }
      - { name: 'views.view.block_content.yml', status: true }
      - { name: 'views.view.comments_recent.yml', status: true }
      - { name: 'views.view.content_recent.yml', status: true }
      - { name: 'views.view.content.yml', status: true }
      - { name: 'views.view.file_entity_files.yml', status: true }
      - { name: 'views.view.files.yml', status: true }
      - { name: 'views.view.frontpage.yml', status: true }
      - { name: 'views.view.glossary.yml', status: true }
      - { name: 'views.view.taxonomy_term.yml', status: true }
      - { name: 'views.view.user_admin_people.yml', status: true }
      - { name: 'views.view.who_s_new.yml', status: true }
      - { name: 'views.view.who_s_online.yml', status: true }
      - { name: 'tour.tour.language-add.yml', status: true }
      - { name: 'tour.tour.language-edit.yml', status: true }
      - { name: 'tour.tour.language.yml', status: true }
      - { name: 'tour.tour.views-ui.yml', status: true }
      # Contributed modules config files:
      - { name: 'embed.button.node.yml', status: true }
      - { name: 'file_entity.settings.yml', status: true }
      - { name: 'file_entity.type.audio.yml', status: true }
      - { name: 'file_entity.type.document.yml', status: true }
      - { name: 'file_entity.type.image.yml', status: true }
      - { name: 'file_entity.type.video.yml', status: true }
      - { name: 'system.menu.devel.yml', status: true }
      - { name: 'config_devel.settings.yml', status: true }
      - { name: 'migrate_plus.migration_group.default.yml', status: true }
      - { name: 'language.content_settings.redirect.redirect.yml', status: true }
      - { name: 'redirect.settings.yml', status: true }
      # Custom modules:
      - { name: 'migrate.migration.ymca_migrate_node_location_schedule.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_block_content_basic.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_block_working_hours_block.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_url_alias_blog.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_url_alias_camp.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_url_alias_location.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_url_alias_page.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_block_content_promo_block.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_file.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_node_article.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_draggableviews.yml', status: true }
      - { name: 'migrate_plus.migration_group.ymca.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_block_content_code_block.yml', status: true }
      - { name: 'migrate_plus.migration_group.example.yml', status: true }
      - { name: 'ymca_migrate.settings.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_file_image.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_node_blog.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_taxonomy_term_tags.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_menu_link_content_camps.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_menu_link_content_child_care_preschool.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_menu_link_content_community_programs.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_menu_link_content_health_fitness.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_menu_link_content_jobs_suppliers_news.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_menu_link_content_kid_teen_activities.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_menu_link_content_locations.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_menu_link_content_main.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_menu_link_content_swimming.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_node_page.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_node_camp.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_node_location.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_block_content_working_hours_block.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_menu_link_content_redirect.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_redirect.yml', status: true }
      - { name: 'core.entity_form_display.block_content.action_block.default.yml', status: true }
      - { name: 'core.entity_view_display.block_content.action_block.default.yml', status: true }
      - { name: 'field.field.block_content.action_block.body.yml', status: true }
      - { name: 'block_content.type.action_block.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_facebook_id.yml', status: true }
      - { name: 'migrate.migration.ymca_migrate_url_alias_tags.yml', status: true }
      - { name: 'views.view.contact_messages_csv_export.yml', status: true }
      - { name: 'image.style.crop_thumbnail.yml', status: true }
      - { name: 'address.address_format.AC.yml', status: true }
      - { name: 'address.address_format.AD.yml', status: true }
      - { name: 'address.address_format.AE.yml', status: true }
      - { name: 'address.address_format.AF.yml', status: true }
      - { name: 'address.address_format.AG.yml', status: true }
      - { name: 'address.address_format.AI.yml', status: true }
      - { name: 'address.address_format.AL.yml', status: true }
      - { name: 'address.address_format.AM.yml', status: true }
      - { name: 'address.address_format.AR.yml', status: true }
      - { name: 'address.address_format.AS.yml', status: true }
      - { name: 'address.address_format.AT.yml', status: true }
      - { name: 'address.address_format.AU.yml', status: true }
      - { name: 'address.address_format.AX.yml', status: true }
      - { name: 'address.address_format.AZ.yml', status: true }
      - { name: 'address.address_format.BA.yml', status: true }
      - { name: 'address.address_format.BB.yml', status: true }
      - { name: 'address.address_format.BD.yml', status: true }
      - { name: 'address.address_format.BE.yml', status: true }
      - { name: 'address.address_format.BF.yml', status: true }
      - { name: 'address.address_format.BG.yml', status: true }
      - { name: 'address.address_format.BH.yml', status: true }
      - { name: 'address.address_format.BJ.yml', status: true }
      - { name: 'address.address_format.BL.yml', status: true }
      - { name: 'address.address_format.BM.yml', status: true }
      - { name: 'address.address_format.BN.yml', status: true }
      - { name: 'address.address_format.BO.yml', status: true }
      - { name: 'address.address_format.BR.yml', status: true }
      - { name: 'address.address_format.BS.yml', status: true }
      - { name: 'address.address_format.BT.yml', status: true }
      - { name: 'address.address_format.BY.yml', status: true }
      - { name: 'address.address_format.CA.yml', status: true }
      - { name: 'address.address_format.CC.yml', status: true }
      - { name: 'address.address_format.CD.yml', status: true }
      - { name: 'address.address_format.CH.yml', status: true }
      - { name: 'address.address_format.CI.yml', status: true }
      - { name: 'address.address_format.CL.yml', status: true }
      - { name: 'address.address_format.CN.yml', status: true }
      - { name: 'address.address_format.CO.yml', status: true }
      - { name: 'address.address_format.CR.yml', status: true }
      - { name: 'address.address_format.CV.yml', status: true }
      - { name: 'address.address_format.CX.yml', status: true }
      - { name: 'address.address_format.CY.yml', status: true }
      - { name: 'address.address_format.CZ.yml', status: true }
      - { name: 'address.address_format.DE.yml', status: true }
      - { name: 'address.address_format.DK.yml', status: true }
      - { name: 'address.address_format.DO.yml', status: true }
      - { name: 'address.address_format.DZ.yml', status: true }
      - { name: 'address.address_format.EC.yml', status: true }
      - { name: 'address.address_format.EE.yml', status: true }
      - { name: 'address.address_format.EG.yml', status: true }
      - { name: 'address.address_format.EH.yml', status: true }
      - { name: 'address.address_format.ES.yml', status: true }
      - { name: 'address.address_format.ET.yml', status: true }
      - { name: 'address.address_format.FI.yml', status: true }
      - { name: 'address.address_format.FK.yml', status: true }
      - { name: 'address.address_format.FM.yml', status: true }
      - { name: 'address.address_format.FO.yml', status: true }
      - { name: 'address.address_format.FR.yml', status: true }
      - { name: 'address.address_format.GB.yml', status: true }
      - { name: 'address.address_format.GE.yml', status: true }
      - { name: 'address.address_format.GF.yml', status: true }
      - { name: 'address.address_format.GG.yml', status: true }
      - { name: 'address.address_format.GI.yml', status: true }
      - { name: 'address.address_format.GL.yml', status: true }
      - { name: 'address.address_format.GN.yml', status: true }
      - { name: 'address.address_format.GP.yml', status: true }
      - { name: 'address.address_format.GR.yml', status: true }
      - { name: 'address.address_format.GS.yml', status: true }
      - { name: 'address.address_format.GT.yml', status: true }
      - { name: 'address.address_format.GU.yml', status: true }
      - { name: 'address.address_format.GW.yml', status: true }
      - { name: 'address.address_format.HK.yml', status: true }
      - { name: 'address.address_format.HN.yml', status: true }
      - { name: 'address.address_format.HR.yml', status: true }
      - { name: 'address.address_format.HT.yml', status: true }
      - { name: 'address.address_format.HU.yml', status: true }
      - { name: 'address.address_format.ID.yml', status: true }
      - { name: 'address.address_format.IE.yml', status: true }
      - { name: 'address.address_format.IL.yml', status: true }
      - { name: 'address.address_format.IM.yml', status: true }
      - { name: 'address.address_format.IN.yml', status: true }
      - { name: 'address.address_format.IO.yml', status: true }
      - { name: 'address.address_format.IQ.yml', status: true }
      - { name: 'address.address_format.IR.yml', status: true }
      - { name: 'address.address_format.IS.yml', status: true }
      - { name: 'address.address_format.IT.yml', status: true }
      - { name: 'address.address_format.JE.yml', status: true }
      - { name: 'address.address_format.JM.yml', status: true }
      - { name: 'address.address_format.JO.yml', status: true }
      - { name: 'address.address_format.JP.yml', status: true }
      - { name: 'address.address_format.KE.yml', status: true }
      - { name: 'address.address_format.KG.yml', status: true }
      - { name: 'address.address_format.KH.yml', status: true }
      - { name: 'address.address_format.KI.yml', status: true }
      - { name: 'address.address_format.KM.yml', status: true }
      - { name: 'address.address_format.KN.yml', status: true }
      - { name: 'address.address_format.KR.yml', status: true }
      - { name: 'address.address_format.KW.yml', status: true }
      - { name: 'address.address_format.KY.yml', status: true }
      - { name: 'address.address_format.KZ.yml', status: true }
      - { name: 'address.address_format.LA.yml', status: true }
      - { name: 'address.address_format.LB.yml', status: true }
      - { name: 'address.address_format.LI.yml', status: true }
      - { name: 'address.address_format.LK.yml', status: true }
      - { name: 'address.address_format.LR.yml', status: true }
      - { name: 'address.address_format.LS.yml', status: true }
      - { name: 'address.address_format.LT.yml', status: true }
      - { name: 'address.address_format.LU.yml', status: true }
      - { name: 'address.address_format.LV.yml', status: true }
      - { name: 'address.address_format.MA.yml', status: true }
      - { name: 'address.address_format.MC.yml', status: true }
      - { name: 'address.address_format.MD.yml', status: true }
      - { name: 'address.address_format.ME.yml', status: true }
      - { name: 'address.address_format.MF.yml', status: true }
      - { name: 'address.address_format.MG.yml', status: true }
      - { name: 'address.address_format.MH.yml', status: true }
      - { name: 'address.address_format.MK.yml', status: true }
      - { name: 'address.address_format.MM.yml', status: true }
      - { name: 'address.address_format.MN.yml', status: true }
      - { name: 'address.address_format.MO.yml', status: true }
      - { name: 'address.address_format.MP.yml', status: true }
      - { name: 'address.address_format.MQ.yml', status: true }
      - { name: 'address.address_format.MR.yml', status: true }
      - { name: 'address.address_format.MT.yml', status: true }
      - { name: 'address.address_format.MU.yml', status: true }
      - { name: 'address.address_format.MV.yml', status: true }
      - { name: 'address.address_format.MW.yml', status: true }
      - { name: 'address.address_format.MX.yml', status: true }
      - { name: 'address.address_format.MY.yml', status: true }
      - { name: 'address.address_format.MZ.yml', status: true }
      - { name: 'address.address_format.NC.yml', status: true }
      - { name: 'address.address_format.NE.yml', status: true }
      - { name: 'address.address_format.NF.yml', status: true }
      - { name: 'address.address_format.NG.yml', status: true }
      - { name: 'address.address_format.NI.yml', status: true }
      - { name: 'address.address_format.NL.yml', status: true }
      - { name: 'address.address_format.NO.yml', status: true }
      - { name: 'address.address_format.NP.yml', status: true }
      - { name: 'address.address_format.NR.yml', status: true }
      - { name: 'address.address_format.NZ.yml', status: true }
      - { name: 'address.address_format.OM.yml', status: true }
      - { name: 'address.address_format.PA.yml', status: true }
      - { name: 'address.address_format.PE.yml', status: true }
      - { name: 'address.address_format.PF.yml', status: true }
      - { name: 'address.address_format.PG.yml', status: true }
      - { name: 'address.address_format.PH.yml', status: true }
      - { name: 'address.address_format.PK.yml', status: true }
      - { name: 'address.address_format.PL.yml', status: true }
      - { name: 'address.address_format.PM.yml', status: true }
      - { name: 'address.address_format.PN.yml', status: true }
      - { name: 'address.address_format.PR.yml', status: true }
      - { name: 'address.address_format.PT.yml', status: true }
      - { name: 'address.address_format.PW.yml', status: true }
      - { name: 'address.address_format.PY.yml', status: true }
      - { name: 'address.address_format.QA.yml', status: true }
      - { name: 'address.address_format.RE.yml', status: true }
      - { name: 'address.address_format.RO.yml', status: true }
      - { name: 'address.address_format.RS.yml', status: true }
      - { name: 'address.address_format.RU.yml', status: true }
      - { name: 'address.address_format.RW.yml', status: true }
      - { name: 'address.address_format.SA.yml', status: true }
      - { name: 'address.address_format.SC.yml', status: true }
      - { name: 'address.address_format.SE.yml', status: true }
      - { name: 'address.address_format.SG.yml', status: true }
      - { name: 'address.address_format.SH.yml', status: true }
      - { name: 'address.address_format.SI.yml', status: true }
      - { name: 'address.address_format.SJ.yml', status: true }
      - { name: 'address.address_format.SK.yml', status: true }
      - { name: 'address.address_format.SM.yml', status: true }
      - { name: 'address.address_format.SN.yml', status: true }
      - { name: 'address.address_format.SO.yml', status: true }
      - { name: 'address.address_format.SR.yml', status: true }
      - { name: 'address.address_format.ST.yml', status: true }
      - { name: 'address.address_format.SV.yml', status: true }
      - { name: 'address.address_format.SZ.yml', status: true }
      - { name: 'address.address_format.TA.yml', status: true }
      - { name: 'address.address_format.TC.yml', status: true }
      - { name: 'address.address_format.TH.yml', status: true }
      - { name: 'address.address_format.TJ.yml', status: true }
      - { name: 'address.address_format.TM.yml', status: true }
      - { name: 'address.address_format.TN.yml', status: true }
      - { name: 'address.address_format.TR.yml', status: true }
      - { name: 'address.address_format.TV.yml', status: true }
      - { name: 'address.address_format.TW.yml', status: true }
      - { name: 'address.address_format.TZ.yml', status: true }
      - { name: 'address.address_format.UA.yml', status: true }
      - { name: 'address.address_format.UM.yml', status: true }
      - { name: 'address.address_format.US.yml', status: true }
      - { name: 'address.address_format.UY.yml', status: true }
      - { name: 'address.address_format.UZ.yml', status: true }
      - { name: 'address.address_format.VA.yml', status: true }
      - { name: 'address.address_format.VC.yml', status: true }
      - { name: 'address.address_format.VE.yml', status: true }
      - { name: 'address.address_format.VG.yml', status: true }
      - { name: 'address.address_format.VI.yml', status: true }
      - { name: 'address.address_format.VN.yml', status: true }
      - { name: 'address.address_format.WF.yml', status: true }
      - { name: 'address.address_format.XK.yml', status: true }
      - { name: 'address.address_format.YT.yml', status: true }
      - { name: 'address.address_format.ZA.yml', status: true }
      - { name: 'address.address_format.ZM.yml', status: true }
      - { name: 'address.address_format.ZZ.yml', status: true }
      - { name: 'views.view.redirect.yml', status: true }
      - { name: 'views.view.ymca_news.yml', status: true }
      - { name: 'views.view.ymca_twin_cities_blog.yml', status: true }
      - { name: 'views.view.scheduled_content.yml', status: true }
      - { name: 'views.view.contact_messages.yml', status: true }
      - { name: 'ymca_personify.settings.yml', status: true }
      - { name: 'contact.form.personal_trainers_individual.yml', status: true }
      - { name: 'comment.type.comment.yml', status: true }
      - { name: 'block.block.classy_page_title.yml', status: true }
      - { name: 'block.block.footercopyright.yml', status: true }
      - { name: 'block.block.footermenucenter.yml', status: true }
      - { name: 'block.block.footermenuleft.yml', status: true }
      - { name: 'block.block.footermenuright.yml', status: true }
      - { name: 'block.block.footermicrosoft.yml', status: true }
      - { name: 'block.block.mainnavigation.yml', status: true }
      - { name: 'block.block.mainpagecontent.yml', status: true }
      - { name: 'block.block.seven_breadcrumbs.yml', status: true }
      - { name: 'block.block.seven_content.yml', status: true }
      - { name: 'block.block.seven_help.yml', status: true }
      - { name: 'block.block.seven_local_actions.yml', status: true }
      - { name: 'block.block.seven_login.yml', status: true }
      - { name: 'block.block.seven_messages.yml', status: true }
      - { name: 'block.block.seven_page_title.yml', status: true }
      - { name: 'block.block.seven_primary_local_tasks.yml', status: true }
      - { name: 'block.block.seven_secondary_local_tasks.yml', status: true }
      - { name: 'block.block.socialiconsfooter.yml', status: true }
      - { name: 'block.block.tabs.yml', status: true }
      - { name: 'block_content.type.alert_block.yml', status: true }
      - { name: 'block_content.type.basic.yml', status: true }
      - { name: 'block_content.type.code_block.yml', status: true }
      - { name: 'block_content.type.date_block.yml', status: true }
      - { name: 'block_content.type.expander_block.yml', status: true }
      - { name: 'block_content.type.image_block.yml', status: true }
      - { name: 'block_content.type.promo_block.yml', status: true }
      - { name: 'block_content.type.slide_show.yml', status: true }
      - { name: 'block_content.type.slide_show_item.yml', status: true }
      - { name: 'block_content.type.working_hours_block.yml', status: true }

  tasks:
    - name: Export config
      shell: drush config-export staging -y

    - name: Remove excluded config files
      file:
        path: '{{ staging }}/{{ item.name }}'
        state: absent
      with_items: exclude
      when: true == {{ item.status }}

    - name: Copy config to profile
      when: workflow_type == 'profile'
      synchronize:
        src: '{{ staging }}/'
        dest: profiles/{{ profile }}/config/install
        delete: yes
        rsync_opts:
          - '--exclude=.htaccess'

    - name: Clean staging directory
      when: workflow_type == 'profile'
      shell: 'rm *.yml'
      args:
        chdir: '{{ staging }}'
